# Feature Specification: AI 辅导对话系统

**Feature Branch**: `001-ai-tutor`  
**Created**: 2025-12-02  
**Status**: Draft  
**Input**: User description: "开发AI辅导对话系统，基于youtu-agent实现"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 基础问答对话 (Priority: P1)

学生在学习编程竞赛题目过程中遇到概念性问题或困惑，能够通过自然语言向 AI 辅导系统提问，获得清晰、准确的解答和指导。

**Why this priority**: 这是最核心的功能，直接解决学生学习过程中的即时需求。即使只实现这一功能，系统也能提供基础的辅导价值。

**Independent Test**: 学生输入一个编程或算法相关的问题（如"什么是动态规划？"），系统在 5 秒内返回准确的解释，可独立验证对话功能是否可用。

**Acceptance Scenarios**:

1. **Given** 学生已登录系统并进入对话界面，**When** 输入问题"什么是二分查找？"，**Then** 系统返回二分查找的定义、原理和基本应用场景
2. **Given** 学生正在学习某个题目，**When** 询问"时间复杂度如何计算？"，**Then** 系统提供时间复杂度的计算方法和具体示例
3. **Given** 学生提出模糊问题，**When** 输入"为什么我的代码很慢？"，**Then** 系统引导学生提供更多信息（代码、题目描述）以便深入分析

---

### User Story 2 - 代码审查与优化建议 (Priority: P2)

学生提交自己编写的代码片段，AI 辅导系统能够分析代码逻辑、指出潜在问题、提供优化建议，帮助学生改进代码质量。

**Why this priority**: 代码审查是提升编程能力的关键环节，能够帮助学生发现自己未注意到的问题，对学习效果有显著提升。

**Independent Test**: 学生粘贴一段包含明显问题的代码（如时间复杂度过高的暴力解法），系统识别问题并给出优化方向，可独立测试代码分析能力。

**Acceptance Scenarios**:

1. **Given** 学生有一段 Python 代码需要审查，**When** 将代码粘贴到对话框，**Then** 系统分析代码结构、指出逻辑错误或性能问题
2. **Given** 代码存在时间复杂度问题，**When** 系统审查代码，**Then** 提供具体的优化建议和改进后的时间复杂度估算
3. **Given** 学生代码正确但风格不佳，**When** 请求代码审查，**Then** 系统提供代码规范建议（命名、结构、可读性）

---

### User Story 3 - 算法概念讲解与示例演示 (Priority: P3)

学生可以请求系统讲解特定算法或数据结构的原理，系统提供由浅入深的解释，配合伪代码或实际代码示例帮助理解。

**Why this priority**: 系统性的算法讲解能够帮助学生建立完整的知识体系，虽然不如即时问答紧迫，但对长期学习价值很大。

**Independent Test**: 学生请求"讲解快速排序算法"，系统提供原理说明、复杂度分析、伪代码和实际代码示例，可独立验证教学能力。

**Acceptance Scenarios**:

1. **Given** 学生想学习某个算法，**When** 请求"讲解并查集数据结构"，**Then** 系统提供并查集的定义、应用场景、基本操作和代码实现
2. **Given** 学生对算法细节有疑问，**When** 追问"为什么要路径压缩？"，**Then** 系统解释路径压缩的作用和性能提升原理
3. **Given** 学生需要实践示例，**When** 请求"给一个并查集的实际应用例子"，**Then** 系统提供具体题目和解题思路

---

### User Story 4 - 错误调试辅助 (Priority: P3)

学生提交编译错误或运行时错误信息，AI 系统分析错误原因，提供调试建议和修复方向。

**Why this priority**: 调试能力是编程的重要技能，AI 辅助能够加速问题定位，但优先级低于主动学习功能。

**Independent Test**: 学生粘贴一个编译错误信息（如 "IndexError: list index out of range"），系统解释错误含义并提示可能的原因，可独立测试错误分析能力。

**Acceptance Scenarios**:

1. **Given** 学生代码出现运行时错误，**When** 提交错误信息和相关代码，**Then** 系统分析错误类型、定位可能的问题行、给出修复建议
2. **Given** 错误信息比较模糊，**When** 学生请求帮助，**Then** 系统引导学生逐步排查（添加调试输出、检查边界条件等）
3. **Given** 代码逻辑错误导致结果不正确，**When** 学生描述预期结果和实际结果，**Then** 系统分析逻辑差异并提出可能的问题点

---

### User Story 5 - 学习进度追踪和建议 (Priority: P4)

系统记录学生的提问历史和学习内容，能够基于学生的学习进度提供个性化的学习建议和知识点推荐。

**Why this priority**: 个性化推荐能够提升学习效率，但需要积累一定的交互数据，因此优先级相对较低。

**Independent Test**: 学生查看学习历史时，系统展示已学习的知识点和推荐的下一步学习内容，可独立验证记录和推荐功能。

**Acceptance Scenarios**:

1. **Given** 学生已使用系统一段时间，**When** 查看学习历史，**Then** 系统展示已讨论的知识点、代码审查记录和学习时长
2. **Given** 系统识别学生的薄弱环节，**When** 生成学习建议，**Then** 推荐相关的练习题目或需要加强的知识点
3. **Given** 学生完成某个知识模块的学习，**When** 请求下一步建议，**Then** 系统推荐进阶内容或相关竞赛题目

---

### Edge Cases

- **长时间无响应**：如果 LLM API 调用超时（超过 30 秒），系统如何提示用户并处理请求？
- **代码格式识别失败**：当学生提交的代码格式混乱或包含特殊字符时，系统如何正确解析？
- **超出上下文长度限制**：当对话历史过长超过 LLM 的上下文窗口时，如何智能截断或总结历史记录？
- **并发用户请求**：多个学生同时提问时，系统如何保证响应速度和稳定性？
- **恶意输入或无意义提问**：如何识别和过滤无效或恶意的输入（如重复提交、垃圾信息）？
- **多语言代码支持**：当学生提交不同编程语言（C++、Python、Java）的代码时，系统能否正确识别和分析？
- **知识边界处理**：当学生提问超出竞赛编程范围（如操作系统、网络协议）时，系统如何引导回归主题？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须提供基于文本的对话界面，支持学生输入自然语言问题
- **FR-002**: 系统必须能够理解并回答编程竞赛相关的问题（算法、数据结构、代码优化等）
- **FR-003**: 系统必须支持代码片段的输入和展示，能够识别常见编程语言（C++、Python、Java）
- **FR-004**: 系统必须能够分析提交的代码，识别逻辑错误、性能问题和代码风格问题
- **FR-005**: 系统必须保留每个用户的对话历史记录，支持上下文连续对话
- **FR-006**: 系统必须在正常情况下 5 秒内返回响应，超时时提供明确提示
- **FR-007**: 系统必须能够解析和展示常见的错误信息（编译错误、运行时错误）
- **FR-008**: 系统必须提供算法和数据结构的讲解功能，包括原理说明和代码示例
- **FR-009**: 系统必须记录用户的学习历史，包括提问内容、讨论的知识点和时间戳
- **FR-010**: 系统必须支持多用户并发访问，保证每个用户的对话独立性
- **FR-011**: 系统必须实现基本的输入过滤，拒绝明显的恶意或无效输入
- **FR-012**: 系统必须在对话上下文过长时自动总结或截断，保证 LLM 调用正常
- **FR-013**: 用户必须能够清除或重置对话历史，开始新的对话会话
- **FR-014**: 系统必须提供基本的用户身份标识机制，区分不同学生的对话会话
- **FR-015**: 系统必须记录所有对话内容到持久化存储，用于后续分析和改进

### Key Entities

- **对话会话（Conversation Session）**: 代表一次完整的学生与 AI 的交互过程，包含会话 ID、用户标识、创建时间、最后更新时间、会话状态（活跃/归档）

- **消息（Message）**: 对话中的单条消息，包含消息 ID、所属会话 ID、发送者角色（学生/AI）、消息内容、消息类型（文本/代码）、时间戳

- **代码片段（Code Snippet）**: 学生提交的代码，包含代码 ID、所属消息 ID、编程语言、代码内容、分析结果（如有）

- **学习记录（Learning Record）**: 学生的学习历史追踪，包含记录 ID、用户标识、讨论的知识点、相关题目、学习时长、时间戳

- **知识点（Knowledge Point）**: 算法或数据结构的知识条目，包含知识点 ID、名称、分类（如排序、图论、动态规划）、难度级别、相关题目列表

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 学生能够在 5 秒内收到 AI 对问题的初始响应（95% 的请求）
- **SC-002**: 系统支持至少 50 个并发用户同时进行对话，响应时间不超过 10 秒
- **SC-003**: 80% 的学生提问能够得到准确且有帮助的回答（基于后续满意度反馈或追问率）
- **SC-004**: 代码审查功能能够识别至少 3 类常见问题（逻辑错误、性能问题、代码风格）
- **SC-005**: 学生能够在 3 次点击内访问完整的对话历史记录
- **SC-006**: 系统在 24 小时内保持 99% 的可用性（排除计划维护时间）
- **SC-007**: 对话上下文管理能够支持至少 20 轮连续对话而不丢失关键信息
- **SC-008**: 每个学生平均每周使用系统进行至少 5 次有效对话（表明系统有实际使用价值）
- **SC-009**: 学生完成一次完整的算法学习（提问→讲解→练习→反馈）的平均时长不超过 30 分钟
- **SC-010**: 系统能够准确识别和拒绝 90% 的无效或恶意输入

### Assumptions

- 学生使用的设备具有稳定的互联网连接
- DeepSeek API 服务保持稳定可用，平均响应时间在 3 秒以内
- 学生具备基本的编程知识，能够准确描述自己的问题
- 对话内容主要集中在编程竞赛相关的算法和数据结构领域
- 系统部署环境有足够的资源处理并发请求（至少 4 核 CPU，8GB 内存）
- 用户身份标识机制已由外部系统提供（如学校账号系统），本系统只需接收用户 ID
- 对话历史的存储空间充足，每个用户至少可以存储 1000 条消息记录
