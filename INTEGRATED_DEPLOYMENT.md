# ğŸš€ CDUT ç«èµ›è®­ç»ƒç³»ç»Ÿ - æ•´åˆéƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¶æ„

æœ¬ç³»ç»Ÿæ•´åˆäº† **AI è¾…å¯¼ç³»ç»Ÿ** å’Œ **OJ è¯„æµ‹ç³»ç»Ÿ** åˆ°ä¸€ä¸ªç»Ÿä¸€çš„ Docker Compose ç¯å¢ƒä¸­ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CDUT ç«èµ›è®­ç»ƒç³»ç»Ÿ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  AI è¾…å¯¼ç³»ç»Ÿ      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  OJ è¯„æµ‹ç³»ç»Ÿ      â”‚     â”‚
â”‚  â”‚  (youtu-agent)   â”‚         â”‚  (QDUOJ)         â”‚     â”‚
â”‚  â”‚  Port: 8848      â”‚         â”‚  Port: 8000      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                              â”‚                â”‚
â”‚         â”‚                              â–¼                â”‚
â”‚         â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚         â”‚                     â”‚  åˆ¤é¢˜æœåŠ¡å™¨       â”‚     â”‚
â”‚         â”‚                     â”‚  (Judge Server)  â”‚     â”‚
â”‚         â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                              â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                        â–¼                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚              â”‚  PostgreSQL      â”‚                       â”‚
â”‚              â”‚  + Redis         â”‚                       â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æœåŠ¡åˆ—è¡¨

| æœåŠ¡åç§° | å®¹å™¨åç§° | ç«¯å£ | æè¿° |
|---------|---------|------|------|
| youtu-agent | cdut-youtu-agent | 8848 | AI è¾…å¯¼å¯¹è¯ç³»ç»Ÿ |
| oj-backend | cdut-oj-backend | 8000 | OJ åç«¯ API + Web ç•Œé¢ |
| oj-judge | cdut-oj-judge | - | åˆ¤é¢˜æœåŠ¡å™¨ï¼ˆå†…éƒ¨ï¼‰ |
| oj-postgres | cdut-oj-postgres | - | PostgreSQL æ•°æ®åº“ |
| oj-redis | cdut-oj-redis | - | Redis ç¼“å­˜ |

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### 1. è¿ç§»åˆ°æ•´åˆç¯å¢ƒ

å¦‚æœä½ ä¹‹å‰å·²ç»éƒ¨ç½²è¿‡ç‹¬ç«‹çš„æœåŠ¡ï¼Œè¿è¡Œè¿ç§»è„šæœ¬ï¼š

```powershell
.\migrate-to-integrated.ps1
```

è¿ç§»è„šæœ¬ä¼šï¼š
- âœ… åœæ­¢æ—§çš„ QDUOJ æœåŠ¡
- âœ… åœæ­¢æ—§çš„ AI Agent æœåŠ¡
- âœ… æ£€æŸ¥å¹¶åˆ›å»ºå¿…è¦çš„æ•°æ®ç›®å½•
- âœ… æ‹‰å–æœ€æ–°çš„ Docker é•œåƒ
- âœ… å¯åŠ¨æ•´åˆåçš„æœåŠ¡

### 2. å…¨æ–°éƒ¨ç½²

å¦‚æœæ˜¯é¦–æ¬¡éƒ¨ç½²ï¼š

```powershell
# 1. æ‹‰å–é•œåƒ
docker-compose pull

# 2. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 3. ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆçº¦ 30 ç§’ï¼‰
Start-Sleep -Seconds 30

# 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
```

## ğŸŒ è®¿é—®åœ°å€

### AI è¾…å¯¼ç³»ç»Ÿ
- **è®¿é—®åœ°å€**: http://localhost:8848
- **åŠŸèƒ½**: 
  - ç®—æ³•é—®é¢˜è§£ç­”
  - ä»£ç å®¡æŸ¥
  - å­¦ä¹ è·¯å¾„æ¨è
  - å¯¹è¯å¼è¾…å¯¼

### OJ è¯„æµ‹ç³»ç»Ÿ
- **ä¸»é¡µ**: http://localhost:8000
- **ç®¡ç†åå°**: http://localhost:8000/admin
- **API æ–‡æ¡£**: http://localhost:8000/api/
- **é»˜è®¤è´¦å·**: 
  - ç”¨æˆ·å: `root`
  - å¯†ç : `rootroot`
  - âš ï¸ **é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç ï¼**

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### æœåŠ¡ç®¡ç†

```powershell
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡å¯å•ä¸ªæœåŠ¡
docker-compose restart youtu-agent
docker-compose restart oj-backend

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs -f youtu-agent
docker-compose logs -f oj-backend
docker-compose logs -f oj-judge
```

### æ•°æ®ç®¡ç†

```powershell
# å¤‡ä»½æ‰€æœ‰æ•°æ®
Compress-Archive -Path .\data\,.\qduoj\data\ -DestinationPath "backup_$(Get-Date -Format 'yyyyMMdd_HHmmss').zip"

# å¤‡ä»½æ•°æ®åº“
docker exec cdut-oj-postgres pg_dump -U onlinejudge onlinejudge > "db_backup_$(Get-Date -Format 'yyyyMMdd_HHmmss').sql"

# æ¢å¤æ•°æ®åº“
Get-Content backup.sql | docker exec -i cdut-oj-postgres psql -U onlinejudge onlinejudge
```

### æ¸…ç†å’Œç»´æŠ¤

```powershell
# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
docker system df

# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨å’Œå·
docker system prune -a --volumes

# æŸ¥çœ‹æ—¥å¿—å¤§å°
docker exec cdut-oj-judge du -sh /log
docker logs cdut-oj-backend 2>&1 | Measure-Object -Line

# æ¸…ç†æ—¥å¿—ï¼ˆéœ€è¦é‡å¯å®¹å™¨ï¼‰
docker-compose restart oj-judge
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### å®æ—¶ç›‘æ§æœåŠ¡èµ„æº

```powershell
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„èµ„æºä½¿ç”¨
docker stats cdut-youtu-agent cdut-oj-backend cdut-oj-judge
```

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```powershell
# AI Agent æ—¥å¿—
docker-compose logs -f --tail=100 youtu-agent

# OJ åç«¯æ—¥å¿—
docker-compose logs -f --tail=100 oj-backend

# åˆ¤é¢˜æœåŠ¡å™¨æ—¥å¿—
docker-compose logs -f --tail=100 oj-judge

# æ•°æ®åº“æ—¥å¿—
docker-compose logs -f --tail=100 oj-postgres

# æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f
```

### è¿›å…¥å®¹å™¨è°ƒè¯•

```powershell
# è¿›å…¥ AI Agent å®¹å™¨
docker exec -it cdut-youtu-agent /bin/bash

# è¿›å…¥ OJ åç«¯å®¹å™¨
docker exec -it cdut-oj-backend /bin/sh

# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker exec -it cdut-oj-postgres psql -U onlinejudge onlinejudge

# æŸ¥çœ‹ Redis æ•°æ®
docker exec -it cdut-oj-redis redis-cli
```

## ğŸ”Œ AI ä¸ OJ é›†æˆ

### API è®¿é—®é…ç½®

åœ¨ AI Agent ä¸­è®¿é—® OJ APIï¼š

```python
# custom_agents/tools/qduoj_integration.py
from custom_agents.tools.qduoj_client import QDUOJClient

# ä½¿ç”¨å†…éƒ¨ç½‘ç»œåœ°å€
client = QDUOJClient(base_url="http://oj-backend:8000")

# ç™»å½•
client.login("username", "password")

# è·å–é¢˜ç›®
problems = client.get_problem_list(limit=10)

# æäº¤ä»£ç 
result = client.submit_code(
    problem_id=1,
    language="C++",
    code="your code here"
)
```

### ç¯å¢ƒå˜é‡è¯´æ˜

`.env` æ–‡ä»¶ä¸­çš„å…³é”®é…ç½®ï¼š

```bash
# AI Agent è®¿é—® OJï¼ˆå®¹å™¨å†…éƒ¨ï¼‰
OJ_API_URL=http://oj-backend:8000

# å¤–éƒ¨è®¿é—® OJï¼ˆæµè§ˆå™¨ï¼‰
OJ_EXTERNAL_URL=http://localhost:8000

# åˆ¤é¢˜æœåŠ¡å™¨ä»¤ç‰Œï¼ˆå¿…é¡»ä¸€è‡´ï¼‰
JUDGE_SERVER_TOKEN=cdut-secure-token-2024
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ç«¯å£å†²çª

**é—®é¢˜**: å¯åŠ¨æ—¶æç¤º 8000 æˆ– 8848 ç«¯å£è¢«å ç”¨

**è§£å†³**:
```powershell
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :8000
netstat -ano | findstr :8848

# ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
# ä¾‹å¦‚å°† 8000 æ”¹ä¸º 8001
ports:
  - "8001:8000"  # å®¿ä¸»æœº:å®¹å™¨
```

### Q2: æœåŠ¡æ— æ³•å¯åŠ¨

**é—®é¢˜**: å®¹å™¨çŠ¶æ€æ˜¾ç¤º Exit æˆ– Restarting

**æ’æŸ¥æ­¥éª¤**:
```powershell
# 1. æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs [æœåŠ¡å]

# 2. æ£€æŸ¥æ•°æ®ç›®å½•æƒé™
ls -la .\qduoj\data\

# 3. æ£€æŸ¥é…ç½®æ–‡ä»¶
cat docker-compose.yml
cat .env

# 4. é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose down -v
docker-compose up -d --build
```

### Q3: OJ æ— æ³•è®¿é—®

**é—®é¢˜**: è®¿é—® http://localhost:8000 è¶…æ—¶æˆ–æ— å“åº”

**è§£å†³**:
```powershell
# 1. æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
docker-compose ps oj-backend

# 2. æ£€æŸ¥åç«¯æ—¥å¿—
docker-compose logs oj-backend

# 3. ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨ï¼ˆé¦–æ¬¡å¯åŠ¨éœ€è¦æ•°æ®åº“è¿ç§»ï¼‰
Start-Sleep -Seconds 60
docker-compose logs oj-backend | Select-String "Booting worker"

# 4. æµ‹è¯• API è¿æ¥
curl http://localhost:8000/api/website
```

### Q4: åˆ¤é¢˜æœåŠ¡å™¨è¿æ¥å¤±è´¥

**é—®é¢˜**: æäº¤ä»£ç åä¸€ç›´æ˜¾ç¤º "Pending"

**æ’æŸ¥**:
```powershell
# 1. æ£€æŸ¥åˆ¤é¢˜æœåŠ¡å™¨æ—¥å¿—
docker-compose logs oj-judge

# 2. éªŒè¯ TOKEN ä¸€è‡´æ€§
# æ£€æŸ¥ docker-compose.yml ä¸­ä¸¤å¤„ TOKEN æ˜¯å¦ç›¸åŒï¼š
# - oj-judge çš„ TOKEN
# - oj-backend çš„ JUDGE_SERVER_TOKEN

# 3. é‡å¯åˆ¤é¢˜æœåŠ¡å™¨
docker-compose restart oj-judge

# 4. åœ¨ OJ ç®¡ç†åå°æŸ¥çœ‹åˆ¤é¢˜æœåŠ¡å™¨çŠ¶æ€
# è®¿é—®: http://localhost:8000/admin/judge_server/
```

### Q5: AI Agent æ— æ³•è¿æ¥ OJ

**é—®é¢˜**: AI Agent è°ƒç”¨ OJ API å¤±è´¥

**æ£€æŸ¥**:
```powershell
# 1. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
docker exec cdut-youtu-agent ping -c 3 oj-backend

# 2. æµ‹è¯• API è®¿é—®
docker exec cdut-youtu-agent curl http://oj-backend:8000/api/website

# 3. æ£€æŸ¥ .env é…ç½®
cat .env | Select-String "OJ_API_URL"

# 4. æŸ¥çœ‹ AI Agent æ—¥å¿—
docker-compose logs youtu-agent | Select-String "OJ"
```

## ğŸ” å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - OJ ç®¡ç†å‘˜å¯†ç ï¼ˆroot/rootrootï¼‰
   - æ•°æ®åº“å¯†ç ï¼ˆonlinejudge/onlinejudgeï¼‰

2. **æ›´æ¢åˆ¤é¢˜ä»¤ç‰Œ**
   ```bash
   # åœ¨ .env å’Œ docker-compose.yml ä¸­æ›´æ–°
   JUDGE_SERVER_TOKEN=your-secure-random-token-here
   ```

3. **é…ç½® HTTPS**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
   - ä½¿ç”¨ Nginx åå‘ä»£ç†
   - ç”³è¯· SSL è¯ä¹¦
   - ä¿®æ”¹ç«¯å£æ˜ å°„

4. **é™åˆ¶å¯¹å¤–è®¿é—®**
   ```yaml
   ports:
     - "127.0.0.1:8000:8000"  # ä»…æœ¬åœ°è®¿é—®
     - "127.0.0.1:8848:8848"
   ```

## ğŸ“ ç›®å½•ç»“æ„

```
cdut_stu_agents/
â”œâ”€â”€ docker-compose.yml          # æ•´åˆçš„ Docker Compose é…ç½®
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ migrate-to-integrated.ps1   # è¿ç§»è„šæœ¬
â”œâ”€â”€ data/                       # AI Agent æ•°æ®
â”‚   â”œâ”€â”€ submissions/            # å­¦ç”Ÿæäº¤çš„ä»£ç 
â”‚   â”œâ”€â”€ training/               # è®­ç»ƒæ•°æ®
â”‚   â”œâ”€â”€ chat_history/           # å¯¹è¯å†å²
â”‚   â””â”€â”€ problems/               # é¢˜ç›®æ•°æ®
â”œâ”€â”€ qduoj/                      # QDUOJ æ•°æ®å’Œé…ç½®
â”‚   â””â”€â”€ data/
â”‚       â”œâ”€â”€ backend/            # åç«¯æ•°æ®ï¼ˆåŒ…æ‹¬é¢˜ç›®ã€æµ‹è¯•ç”¨ä¾‹ï¼‰
â”‚       â”œâ”€â”€ postgres/           # PostgreSQL æ•°æ®
â”‚       â”œâ”€â”€ redis/              # Redis æ•°æ®
â”‚       â””â”€â”€ judge_server/       # åˆ¤é¢˜æœåŠ¡å™¨æ—¥å¿—
â”œâ”€â”€ custom_agents/              # è‡ªå®šä¹‰ AI Agent
â”‚   â””â”€â”€ tools/
â”‚       â””â”€â”€ qduoj_client.py     # OJ API å®¢æˆ·ç«¯
â””â”€â”€ youtu-agent/                # Youtu-agent æºç 
```

## ğŸ“ åç»­å¼€å‘

### ä¸‹ä¸€æ­¥ä»»åŠ¡

1. **é…ç½® OJ ç³»ç»Ÿ**
   - [ ] ç™»å½•ç®¡ç†åå°ä¿®æ”¹å¯†ç 
   - [ ] å¯¼å…¥é¢˜ç›®æˆ–åˆ›å»ºæµ‹è¯•é¢˜ç›®
   - [ ] åˆ›å»ºæµ‹è¯•ç”¨æˆ·è´¦å·
   - [ ] éªŒè¯åˆ¤é¢˜åŠŸèƒ½

2. **å¼€å‘ AI é›†æˆåŠŸèƒ½**
   - [ ] å®ç°é¢˜ç›®æ¨èç®—æ³•
   - [ ] å¼€å‘ä»£ç åˆ†æåŠŸèƒ½
   - [ ] åˆ›å»ºå­¦ä¹ è·¯å¾„è§„åˆ’
   - [ ] å®ç°æäº¤ç»“æœåé¦ˆ

3. **åˆ›å»ºåŠŸèƒ½è§„æ ¼**
   ```bash
   # ä½¿ç”¨ speckit åˆ›å»ºæ–°åŠŸèƒ½è§„æ ¼
   /speckit.specify é›†æˆ QDUOJ è¯„æµ‹ç³»ç»Ÿï¼Œå®ç° AI æ™ºèƒ½é¢˜ç›®æ¨èå’Œä»£ç åˆ†æåé¦ˆåŠŸèƒ½
   ```

### å¼€å‘èµ„æº

- **AI Agent é…ç½®**: `./custom_agents/configs/`
- **å·¥å…·å¼€å‘**: `./custom_agents/tools/`
- **API æ–‡æ¡£**: `./docs/QDUOJ_INTEGRATION.md`
- **æµ‹è¯•è„šæœ¬**: `./test_qduoj.py`

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æœåŠ¡æ—¥å¿—å®šä½é—®é¢˜
2. å‚è€ƒæœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
3. æ£€æŸ¥ GitHub Issues
4. æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼š
   - [QDUOJ æ–‡æ¡£](http://opensource.qduoj.com/)
   - [Youtu-agent æ–‡æ¡£](https://github.com/tencent/youtu-agent)

---

**æœ€åæ›´æ–°**: 2025-12-02  
**ç‰ˆæœ¬**: v1.0.0
